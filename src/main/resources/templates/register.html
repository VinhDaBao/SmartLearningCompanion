<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký - Smart Learning</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="card shadow-sm border-0" style="margin-top: 50px; margin-bottom: 50px;">
                <div class="card-body p-4">
                    <h3 class="text-center mb-4">Tạo tài khoản</h3>

                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="fullName" class="form-label">Họ và tên</label>
                            <input type="text" class="form-control" id="fullName" required>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>

                        <div class="mb-3">
                            <label for="username" class="form-label">Tên đăng nhập</label>
                            <input type="text" class="form-control" id="username" minlength="3" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Mật khẩu</label>
                            <input type="password" class="form-control" id="password" minlength="6" required>
                        </div>

                        <hr>

                        <div class="mb-3">
                            <label for="learningStyle" class="form-label fw-bold">
                                Phong cách học của bạn?
                                <small class="text-muted">(Giúp AI gợi ý tốt hơn)</small>
                            </label>
                            <select class="form-select" id="learningStyle">
                                <option value="">-- Chọn phong cách học --</option>
                                <option value="Visual">Visual (Hình ảnh)</option>
                                <option value="Auditory">Auditory (Âm thanh)</option>
                                <option value="Reading/Writing">Reading/Writing (Đọc/Viết)</option>
                                <option value="Kinesthetic">Kinesthetic (Thực hành)</option>
                                <option value="General">General (Tổng quát)</option>
                            </select>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary">Đăng ký</button>
                        </div>
                    </form>

                    <div id="errorMessage" class="alert alert-danger mt-3 d-none" role="alert"></div>

                    <div id="successMessage" class="alert alert-success mt-3 d-none" role="alert">
                        Đăng ký thành công! Đang chuyển bạn đến trang đăng nhập...
                    </div>

                </div>
                <div class="card-footer text-center py-3">
                    <small>Đã có tài khoản? <a href="/login">Đăng nhập</a></small>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script>
    $(document).ready(function() {

        $("#registerForm").on("submit", function(event) {
            event.preventDefault();

            $("#errorMessage").addClass("d-none");
            $("#successMessage").addClass("d-none");

            // 1. Lấy dữ liệu từ form
            var registerData = {
                fullName: $("#fullName").val(),
                email: $("#email").val(),
                username: $("#username").val(),
                password: $("#password").val(),
                learningStyle: $("#learningStyle").val() || "General" // Gán giá trị mặc định nếu không chọn
            };

            // 2. Gửi yêu cầu AJAX đến Backend
            $.ajax({
                type: "POST",
                url: "http://localhost:8080/api/auth/register", // API register của bạn
                contentType: "application/json",
                data: JSON.stringify(registerData),

                // 3. Xử lý khi THÀNH CÔNG
                success: function(response) {
                    // Hiển thị thông báo thành công
                    $("#successMessage").removeClass("d-none");

                    // Chờ 2 giây rồi chuyển về trang login
                    setTimeout(function() {
                        window.location.href = "/login";
                    }, 2000);
                },

                // 4. Xử lý khi THẤT BẠI
                error: function(xhr) {
                    // xhr.responseText là thông báo từ @ExceptionHandler
                    var errorMsg = xhr.responseText || "Lỗi không xác định";

                    $("#errorMessage").text(errorMsg);
                    $("#errorMessage").removeClass("d-none");
                }
            });
        });
    });
</script>
</body>
</html>